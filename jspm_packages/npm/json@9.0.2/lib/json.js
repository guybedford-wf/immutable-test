/* */
!function(process){function getVersion(){return VERSION}function objCopy(t){var e;return Array.isArray(t)?e=t.slice():"object"==typeof t?(e={},Object.keys(t).forEach(function(r){e[r]=t[r]})):e=t,e}function format(t){if("string"!=typeof t){for(var e=[],r=0;r<arguments.length;r++)e.push(util.inspect(arguments[r]));return e.join(" ")}for(var r=1,n=arguments,i=n.length,s=String(t).replace(formatRegExp,function(t){if(r>=i)return t;switch(t){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":return JSON.stringify(n[r++]);case"%%":return"%";default:return t}}),o=n[r];i>r;o=n[++r])s+=null===o||"object"!=typeof o?" "+o:" "+util.inspect(o);return s}function _parseString(s){var quoted='"'+s.replace(/\\"/,'"').replace('"','\\"')+'"';return eval(quoted)}function printHelp(){var t=console.log;t("Usage:"),t("  <something generating JSON on stdout> | json [OPTIONS] [LOOKUPS...]"),t("  json -f FILE [OPTIONS] [LOOKUPS...]"),t(""),t("Pipe in your JSON for pretty-printing, JSON validation, filtering, "),t("and modification. Supply one or more `LOOKUPS` to extract a "),t("subset of the JSON. HTTP header blocks are skipped by default."),t("Roughly in order of processing, features are:"),t(""),t("Grouping:"),t('  Use "-g" or "--group" to group adjacent objects, separated by'),t("  by no space or a by a newline, or adjacent arrays, separate by"),t("  by a newline. This can be helpful for, e.g.: "),t("     $ cat *.json | json -g ... "),t("  and similar."),t(""),t("Execution:"),t('  Use the "-e CODE" option to execute JavaScript code on the input JSON.'),t('     $ echo \'{"name":"trent","age":38}\' | json -e \'this.age++\''),t("     {"),t('       "name": "trent",'),t('       "age": 39'),t("     }"),t("  If input is an array, this will automatically process each"),t("  item separately."),t(""),t("Conditional filtering:"),t('  Use the "-c CODE" option to filter the input JSON.'),t("     $ echo '[{\"age\":38},{\"age\":4}]' | json -c 'this.age>21'"),t("     [{'age':38}]"),t("  If input is an array, this will automatically process each"),t('  item separately. Note: "CODE" is JavaScript code.'),t(""),t("Lookups:"),t("  Use lookup arguments to extract particular values:"),t('     $ echo \'{"name":"trent","age":38}\' | json name'),t("     trent"),t(""),t('  Use "-a" for *array processing* of lookups and *tabular output*:'),t('     $ echo \'{"name":"trent","age":38}\' | json name age'),t("     trent"),t("     38"),t('     $ echo \'[{"name":"trent","age":38},'),t('               {"name":"ewan","age":4}]\' | json -a name age'),t("     trent 38"),t("     ewan 4"),t(""),t("In-place editing:"),t('  Use "-I, --in-place" to edit a file in place:'),t("     $ json -I -f config.json  # reformat"),t("     $ json -I -f config.json -c 'this.logLevel=\"debug\"' # add field"),t(""),t("Pretty-printing:"),t('  Output is "jsony" by default: 2-space indented JSON, except a'),t("  single string value is printed without quotes."),t('     $ echo \'{"name": "trent", "age": 38}\' | json'),t("     {"),t('       "name": "trent",'),t('       "age": 38'),t("     }"),t('     $ echo \'{"name": "trent", "age": 38}\' | json name'),t("     trent"),t(""),t("  Use '-j' or '-o json' for explicit JSON, '-o json-N' for N-space indent:"),t('     $ echo \'{"name": "trent", "age": 38}\' | json -o json-0'),t('     {"name":"trent","age":38}'),t(""),t("Options:"),t("  -h, --help    Print this help info and exit."),t("  --version     Print version of this command and exit."),t("  -q, --quiet   Don't warn if input isn't valid JSON."),t(""),t("  -f FILE       Path to a file to process. If not given, then"),t("                stdin is used."),t('  -I, --in-place  In-place edit of the file given with "-f".'),t("                Lookups are not allow with in-place editing"),t("                because it makes it too easy to lose content."),t(""),t("  -H            Drop any HTTP header block (as from `curl -i ...`)."),t("  -g, --group   Group adjacent objects or arrays into an array."),t("  --merge       Merge adjacent objects into one. Keys in last "),t("                object win."),t('  --deep-merge  Same as "--merge", but will recurse into objects '),t("                under the same key in both."),t("  -a, --array   Process input as an array of separate inputs"),t("                and output in tabular form."),t("  -A            Process input as a single object, i.e. stop"),t('                "-e" and "-c" automatically processing each'),t("                item of an input array."),t('  -d DELIM      Delimiter char for tabular output (default is " ").'),t('  -D DELIM      Delimiter char between lookups (default is "."). E.g.:'),t('                    $ echo \'{"a.b": {"b": 1}}\' | json -D / a.b/b'),t(""),t("  -M, --items   Itemize an object into an array of "),t('                    {"key": <key>, "value": <value>}'),t("                objects for easier processing."),t(""),t("  -e CODE       Execute the given JavaScript code on the input. If input"),t("                is an array, then each item of the array is processed"),t('                separately (use "-A" to override).'),t("  -c CODE       Filter the input with JavaScript `CODE`. If `CODE`"),t("                returns false-y, then the item is filtered out. If"),t("                input is an array, then each item of the array is "),t('                processed separately (use "-A" to override).'),t(""),t("  -k, --keys    Output the input object's keys."),t("  -n, --validate  Just validate the input (no processing or output)."),t('                Use with "-q" for silent validation (exit status).'),t(""),t("  -o, --output MODE"),t("                Specify an output mode. One of:"),t("                    jsony (default): JSON with string quotes elided"),t("                    json: JSON output, 2-space indent"),t('                    json-N: JSON output, N-space indent, e.g. "json-4"'),t("                    inspect: node.js `util.inspect` output"),t("  -i            Shortcut for `-o inspect`"),t("  -j            Shortcut for `-o json`"),t("  -0, -2, -4    Set indentation to the given value w/o setting MODE."),t("                    -0   =>  -o jsony-0"),t("                    -4   =>  -o jsony-4"),t("                    -j0  =>  -o json-0"),t(""),t("See <http://trentm.com/json> for more docs and "),t("<https://github.com/trentm/json> for project details.")}function parseArgv(t){for(var e={args:[],help:!1,quiet:!1,dropHeaders:!1,exeSnippets:[],condSnippets:[],outputMode:OM_JSONY,jsonIndent:2,array:null,delim:" ",lookupDelim:".",items:!1,outputKeys:!1,group:!1,merge:null,inputFiles:[],validate:!1,inPlace:!1},r=t.slice(2),n=[],i={d:!0,o:!0,D:!0},s=0;s<r.length;s++){if("--"===r[s]){n=n.concat(r.slice(s));break}if("-"===r[s].charAt(0)&&"-"!==r[s].charAt(1)&&r[s].length>2){for(var o=r[s].slice(1).split(""),u=0;u<o.length;u++)if(n.push("-"+o[u]),i[o[u]]){var a=o.slice(u+1).join("");a.length&&n.push(a);break}}else n.push(r[s])}for(r=n,endOfOptions=!1;r.length>0;){var h=r.shift();if(endOfOptions){e.args.push(h);break}switch(h){case"--":endOfOptions=!0;break;case"-h":case"--help":e.help=!0;break;case"--version":e.version=!0;break;case"-q":case"--quiet":e.quiet=!0;break;case"-H":e.dropHeaders=!0;break;case"-o":case"--output":var c=r.shift();if(!c)throw new Error('no argument given for "-o|--output" option');var f=c.lastIndexOf("-");if(-1!==f){var l=c.slice(f+1);/^\d+$/.test(l)?(e.jsonIndent=Number(l),c=c.slice(0,f)):"tab"===l&&(e.jsonIndent="	",c=c.slice(0,f))}if(e.outputMode=OM_FROM_NAME[c],void 0===e.outputMode)throw new Error('unknown output mode: "'+c+'"');break;case"-0":e.jsonIndent=0;break;case"-2":e.jsonIndent=2;break;case"-4":e.jsonIndent=4;break;case"-I":case"--in-place":e.inPlace=!0;break;case"-i":e.outputMode=OM_INSPECT;break;case"-j":e.outputMode=OM_JSON;break;case"-a":case"--array":e.array=!0;break;case"-A":e.array=!1;break;case"-d":e.delim=_parseString(r.shift());break;case"-D":if(e.lookupDelim=r.shift(),1!==e.lookupDelim.length)throw new Error(format('invalid lookup delim "%s" (must be a single char)',e.lookupDelim));break;case"-e":case"-E":e.exeSnippets.push(r.shift());break;case"-c":case"-C":e.condSnippets.push(r.shift());break;case"-M":case"--items":e.items=!0;break;case"-k":case"--keys":e.outputKeys=!0;break;case"-g":case"--group":e.group=!0;break;case"--merge":e.merge="shallow";break;case"--deep-merge":e.merge="deep";break;case"-f":e.inputFiles.push(r.shift());break;case"-n":case"--validate":e.validate=!0;break;default:if(!endOfOptions&&h.length>0&&"-"===h[0])throw new Error('unknown option "'+h+'"');e.args.push(h)}}if(e.group&&e.merge)throw new Error("cannot use -g|--group and --merge options together");if(e.outputKeys&&e.args.length>0)throw new Error("cannot use -k|--keys option and lookup arguments together");if(e.inPlace&&1!==e.inputFiles.length)throw new Error('must specify exactly one file with "-f FILE" to use -I/--in-place');if(e.inPlace&&e.args.length>0)throw new Error("lookups cannot be specified with in-place editing (-I/--in-place), too easy to lose content");return e}function chunkEmitter(t){function r(e){for(;;){if("HTTP/"===e.slice(0,5)){var r=e.indexOf("\r\n\r\n"),n=4;if(-1==r&&(r=e.indexOf("\n\n"),n=2),-1!=r){t.dropHeaders||emit(e.slice(0,r+n));var i="HTTP/1.1 100 Continue"===e.slice(0,21);if(e=e.slice(r+n),i)continue;f=!0}}else f=!0;break}return e}function n(t,e){var r=/(})(\s*\n\s*)?({\s*")/,n=t.trimLeft();if(n&&"{"!==n[0])return a=!1,h.push(t),"";var i=t.split(r);if(1===i.length){var s=t.split(/\s*\r?\n/)[0];if("}"===s[s.length-1]){var o;try{o=JSON.parse(t)}catch(u){}void 0!==o&&(e.emit("chunk",t,o),t="")}return t}var c,f=i.length-2;c=i[0]+i[1],e.emit("chunk",c,JSON.parse(c));for(var l=3;f>l;l+=4)c=i[l]+i[l+1]+i[l+2],e.emit("chunk",c,JSON.parse(c));return i[f]+i[f+1]}function i(t){t.on("data",function(t){var e=c+t;if(f||(e=r(e)),f){if(!a)return void h.push(t);c=n(e,u)}else c=e})}function s(r){r.on("error",function(){u.emit("error",format('could not read "%s": %s',t.inputFiles[l],e))})}function o(e){e.on("end",function(){if(l<t.inputFiles.length){var e=t.inputFiles[l++],r=fs.createReadStream(e,{encoding:"utf8"});s(r),o(r),i(r)}else a?c&&(c=n(c,u),u.emit("chunk",c)):u.emit("chunk",h.join("")),u.emit("end")})}var u=new EventEmitter,a=!0,h=[],c="",f=!1;if(t.inputFiles.length>0){var l=0,_=fs.createReadStream(t.inputFiles[l++],{encoding:"utf8"});s(_),o(_),i(_)}else{var p=process.openStdin();p.setEncoding("utf8"),i(p),p.on("end",function(){a?c&&(c=n(c,u),u.emit("chunk",c)):u.emit("chunk",h.join("")),u.emit("end")})}return u}function getInput(t,e){if(0===t.inputFiles.length){var r=[],n=process.openStdin();n.setEncoding("utf8"),n.on("data",function(t){r.push(t)}),n.on("end",function(){e(null,r.join(""))})}else if(t.inPlace)for(var i=0;i<t.inputFiles.length;i++){var s,o=t.inputFiles[i];try{s=fs.readFileSync(o,"utf8")}catch(u){e(u,null,o)}s&&e(null,s,o)}else{var i=0,r=[];try{for(;i<t.inputFiles.length;i++)r.push(fs.readFileSync(t.inputFiles[i],"utf8"))}catch(u){return e(format('could not read "%s": %s',t.inputFiles[i],u))}e(null,r.join(""),1===t.inputFiles.length?t.inputFiles[0]:void 0)}}function isInteger(t){return 0==t.search(/^-?[0-9]+$/)}function parseLookup(t,e){var r=function(){},n=[];r("\n*** "+t+" ***"),n=[],e=e||".";for(var i="",s=[null],o=!1,u=null,a=0;a<t.length;++a){var o=!o&&"\\"===u,u=t[a];if(r("-- i="+a+", ch="+JSON.stringify(u)+" escaped="+JSON.stringify(o)),r("states: "+JSON.stringify(s)),o)i+=u;else{switch(s[s.length-1]){case null:switch(u){case'"':case"'":s.push(u),i+=u;break;case"[":s.push(u),""!==i&&(n.push(i),i=""),i+=u;break;case e:""!==i&&(n.push(i),i="");break;default:i+=u}break;case"[":switch(i+=u,u){case'"':case"'":case"[":s.push(u);break;case"]":if(s.pop(),null===s[s.length-1]){var h=vm.runInNewContext("("+i.slice(1,-1)+")",{},"<lookup>");n.push(h),i=""}}break;case'"':switch(i+=u,u){case'"':s.pop(),null===s[s.length-1]&&(n.push(i),i="")}break;case"'":switch(i+=u,u){case"'":s.pop(),null===s[s.length-1]&&(n.push(i),i="")}}r("bit: "+JSON.stringify(i)),r("bits: "+JSON.stringify(n))}}""!==i&&(n.push(i),i="");for(var c=/^-\d+$/,a=0;a<n.length;a++)c.test(n[a])&&(n[a]=Number(n[a]));return r(JSON.stringify(t)+" -> "+JSON.stringify(n)),n}function parseInput(t,e,r,n){function i(t,e){Object.keys(e).forEach(function(r){t[r]&&e[r]&&"[object Object]"===toString.call(t[r])&&"[object Object]"===toString.call(e[r])?i(t[r],e[r]):t[r]=e[r]})}if(e)return{datum:e};if(r){var s=t;[/(})\s*\n\s*({)/g,/(})({")/g].forEach(function(t){s=s.replace(t,"$1,\n$2")}),[/(\])\s*\n\s*(\[)/g].forEach(function(t){s=s.replace(t,",\n")}),s=s.trim(),"["!==s[0]&&(s="[\n"+s),"]"!==s.slice(-1)&&(s+="\n]\n");try{return{datum:JSON.parse(s)}}catch(o){return{error:o}}}else{if(n){var s=t;[/(})\s*\n\s*({)/g,/(})({")/g].forEach(function(t){s=s.replace(t,"$1,\n$2")}),s="[\n"+s+"\n]\n";var u;try{u=JSON.parse(s)}catch(a){return{error:a}}var h=u[0];if("shallow"===n)for(var c=1;c<u.length;c++){var e=u[c];Object.keys(e).forEach(function(t){h[t]=e[t]})}else{if("deep"!==n)throw new Error(format('unknown value for "merge": "%s"',n));for(var c=1;c<u.length;c++)i(h,u[c])}return{datum:h}}try{return{datum:JSON.parse(t)}}catch(a){return{error:a}}}}function lookupDatum(t,e){for(var r=t,n=0;n<e.length;n++){var i=e[n];if(r="number"==typeof i&&0>i?r[r.length+i]:r[i],void 0===r)return void 0}return r}function printDatasets(t,e,r,n){var i=e?!1:process.stdout.isTTY,s=emit;if(e){var o=path.resolve(path.dirname(e),format(".%s-json-%s-%s.tmp",path.basename(e),process.pid,Date.now())),u=fs.statSync(e),a=fs.createWriteStream(o,{encoding:"utf8",mode:u.mode});s=a.write.bind(a)}r&&r.length>0&&s(r);for(var h=0;h<t.length;h++){var c=t[h],f=stringifyDatum(c[0],n,i),l=c[1];f&&f.length?(s(f),s(l)):c[2]&&s(l)}e&&(a.end(),fs.renameSync(o,e),n.quiet||warn('json: updated "%s" in-place',e))}function stringifyDatum(t,e,r){var n=null;switch(e.outputMode){case OM_INSPECT:n=util.inspect(t,!1,1/0,r);break;case OM_JSON:"undefined"!=typeof t&&(n=JSON.stringify(t,null,e.jsonIndent));break;case OM_COMPACT:if(void 0===t);else if(Array.isArray(t)){var i=["[\n"];t.forEach(function(t){i.push("  "),i.push(JSON.stringify(t,null,0).replace(/,"(?![,:])/g,', "')),i.push(",\n")}),i.push(i.pop().slice(0,-2)+"\n"),i.push("]"),n=i.join("")}else n=JSON.stringify(t,null,0);break;case OM_JSONY:"string"==typeof t?n=t:"undefined"!=typeof t&&(n=JSON.stringify(t,null,e.jsonIndent));break;default:throw new Error("unknown output mode: "+e.outputMode)}return n}function printDatum(t,e,r,n){var i=stringifyDatum(t,e);i&&i.length?(emit(i),emit(r)):n&&emit(r)}function emit(t){if(!drainingStdout)try{stdoutFlushed=process.stdout.write(t)}catch(e){}}function drainStdoutAndExit(t){drainingStdout||(drainingStdout=!0,process.stdout.on("drain",function(){process.exit(t)}),process.stdout.on("close",function(){process.exit(t)}),stdoutFlushed&&process.exit(t))}function funcWithReturnFromSnippet(t){return-1===t.indexOf("return")&&(";"===t.substring(t.length-1)&&(t=t.substring(0,t.length-1)),t="return ("+t+")"),new Function(t)}function main(t){function e(t,e,n,i,s){if(t.length){var o=parseInput(t,e,r.group,r.merge);if(o.error){if(!r.quiet){var u="",v=t.replace(/\r\n|\n|\r/,"\n");try{json_parse(v),u=o.error}catch(d){var g,y,m=d.at-1,w=t.split("\n"),b=0;for(g=0;g<w.length;g++)if(b+=w[g].length+1,b>m){y=m-(b-w[g].length-1);break}for(var S="",I=0;y>I;I++)S+=".";u=d.message+" at line "+(g+1)+", column "+(y+1)+":\n        "+w[g]+"\n        "+S+"^"}warn("json: error: %s is not JSON: %s",n?'"'+n+'"':"input",u)}return r.validate||(emit(t),t.length&&"\n"!==t[t.length-1]&&emit("\n")),drainStdoutAndExit(1)}if(r.validate)return drainStdoutAndExit(0);var x=o.datum;if(r.items&&!Array.isArray(x)){var k,q=[];for(k in x)x.hasOwnProperty(k)&&q.push({key:k,value:x[k]});x=q}var I,z;if(_)if(r.array||null===r.array&&Array.isArray(x)){var O=!1;for(Array.isArray(x)||(O=!0,x=[x]),I=0;I<x.length;I++){var E=x[I];for(z=0;z<f.length;z++)f[z].call(E);for(z=0;z<l.length;z++)l[z].runInNewContext(E)}O&&(x=x[0])}else{for(z=0;z<f.length;z++)f[z].call(x);for(z=0;z<l.length;z++)l[z].runInNewContext(x)}else;if(c)if(r.array||null===r.array&&Array.isArray(x)){var O=!1;Array.isArray(x)||(O=!0,x=[x]);var j=[];for(I=0;I<x.length;I++){var E=x[I],C=objCopy(E),M=!0;for(z=0;z<a.length;z++)if(!a[z].call(C)){M=!1;break}if(M){for(z=0;z<h.length;z++)if(!h[z].runInNewContext(C)){M=!1;break}M&&j.push(E)}}x=O?j.length?j[0]:[]:j}else{var M=!0,D=objCopy(x);for(z=0;z<a.length;z++)if(!a[z].call(D)){M=!1;break}if(M)for(z=0;z<h.length;z++)if(!h[z].runInNewContext(D)){M=!1;break}M||(x=void 0)}else;var A=!1;if(p.length)if(r.array){Array.isArray(x)||(x=[x]);var P=[];for(z=0;z<x.length;z++){var E=x[z],K={};for(I=0;I<p.length;I++){var B=p[I],R=lookupDatum(E,B);void 0!==R&&(K[B.join(".")]=R)}P.push(K)}x=P}else{if(Array.isArray(x))for(A=!0,I=0;I<p.length;I++)if(1!==p[I].length||isNaN(Number(p[I]))){A=!1;break}var K={};for(I=0;I<p.length;I++){var B=p[I],R=lookupDatum(x,B);void 0!==R&&(K[B.join(".")]=R)}x=K}if(r.outputKeys)var x=Object.keys(x);var N=[];if(r.outputMode===OM_JSON){if(1!==p.length||r.array){if(A){var T=[];for(I=0;I<p.length;I++){var U=p[I].join(".");x.hasOwnProperty(U)&&T.push(x[U])}x=T}}else x=x[p[0].join(".")];N.push([x,"\n",!1])}else if(p.length)if(r.array)for(z=0;z<x.length;z++){var K=x[z];for(I=0;I<p.length-1;I++)N.push([K[p[I].join(".")],r.delim,!0]);N.push([K[p[I].join(".")],"\n",!0])}else for(I=0;I<p.length;I++)N.push([x[p[I].join(".")],"\n",!1]);else if(r.array)for(Array.isArray(x)||(x=[x]),z=0;z<x.length;z++)N.push([x[z],"\n",!1]);else N.push([x,"\n",!1]);printDatasets(N,i?n:void 0,s,r)}}var r;try{r=parseArgv(t)}catch(n){return warn("json: error: %s",n.message),drainStdoutAndExit(1)}if(r.help)return void printHelp();if(r.version)if(r.outputMode===OM_JSON){var i={version:getVersion(),author:"Trent Mick",project:"https://github.com/trentm/json"};console.log(JSON.stringify(i,null,r.jsonIndent))}else console.log("json "+getVersion()),console.log("written by Trent Mick"),console.log("https://github.com/trentm/json");else{var s,o=r.args,u=Boolean(process.env.JSON_EXEC&&"vm"===process.env.JSON_EXEC),a=[];if(!u)for(s=0;s<r.condSnippets.length;s++)a[s]=funcWithReturnFromSnippet(r.condSnippets[s]);var h=[];if(u)for(s=0;s<r.condSnippets.length;s++)h[s]=vm.createScript(r.condSnippets[s]);var c=Boolean(a.length+h.length),f=[];if(!u)for(s=0;s<r.exeSnippets.length;s++)f[s]=new Function(r.exeSnippets[s]);var l=[];if(u)for(s=0;s<r.exeSnippets.length;s++)l[s]=vm.createScript(r.exeSnippets[s]);var _=Boolean(f.length+l.length),p=o.map(function(t){return parseLookup(t,r.lookupDelim)});if(r.group&&r.array&&r.outputMode!==OM_JSON){var v=chunkEmitter(r);v.on("error",function(){return warn("json: error: %s",err),drainStdoutAndExit(1)}),v.on("chunk",e)}else r.inPlace?(assert.equal(r.inputFiles.length,1,"cannot handle more than one file with -I"),getInput(r,function(t,n,i){if(t)return warn("json: error: %s",t),drainStdoutAndExit(1);for(var s=[];;){if("HTTP/"===n.slice(0,5)){var o=n.indexOf("\r\n\r\n"),u=4;if(-1==o&&(o=n.indexOf("\n\n"),u=2),-1!=o){r.dropHeaders||s.push(n.slice(0,o+u));var a="HTTP/1.1 100 Continue"===n.slice(0,21);if(n=n.slice(o+u),a)continue}}break}e(n,void 0,i,!0,s.join(""))})):getInput(r,function(t,n,i){if(t)return warn("json: error: %s",t),drainStdoutAndExit(1);for(;;){if("HTTP/"===n.slice(0,5)){var s=n.indexOf("\r\n\r\n"),o=4;if(-1==s&&(s=n.indexOf("\n\n"),o=2),-1!=s){r.dropHeaders||emit(n.slice(0,s+o));var u="HTTP/1.1 100 Continue"===n.slice(0,21);if(n=n.slice(s+o),u)continue}}break}e(n,null,i,!1)})}}var VERSION="9.0.2",p=console.warn,util=require("github:jspm/nodelibs@0.0.5/util"),assert=require("github:jspm/nodelibs@0.0.5/assert"),path=require("github:jspm/nodelibs@0.0.5/path"),vm=require("github:jspm/nodelibs@0.0.5/vm"),fs=require("github:jspm/nodelibs@0.0.5/fs"),warn=console.warn,EventEmitter=require("github:jspm/nodelibs@0.0.5/events").EventEmitter;exports.main=main,exports.getVersion=getVersion,exports.parseLookup=parseLookup,exports.lookupDatum=lookupDatum,exports.printDatum=printDatum;var OM_JSONY=1,OM_JSON=2,OM_INSPECT=3,OM_COMPACT=4,OM_FROM_NAME={jsony:OM_JSONY,json:OM_JSON,inspect:OM_INSPECT,compact:OM_COMPACT};if(util.format)format=util.format;else var formatRegExp=/%[sdj%]/g;var json_parse=function(){"use strict";var t,e,r,n,i={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"},s=function(e){throw{name:"SyntaxError",message:e,at:t,text:r}},o=function(n){return n&&n!==e&&s("Expected '"+n+"' instead of '"+e+"'"),e=r.charAt(t),t+=1,e},u=function(){var t,r="";for("-"===e&&(r="-",o("-"));e>="0"&&"9">=e;)r+=e,o();if("."===e)for(r+=".";o()&&e>="0"&&"9">=e;)r+=e;if("e"===e||"E"===e)for(r+=e,o(),("-"===e||"+"===e)&&(r+=e,o());e>="0"&&"9">=e;)r+=e,o();return t=+r,isFinite(t)?t:void s("Bad number")},a=function(){var t,r,n,u="";if('"'===e)for(;o();){if('"'===e)return o(),u;if("\\"===e)if(o(),"u"===e){for(n=0,r=0;4>r&&(t=parseInt(o(),16),isFinite(t));r+=1)n=16*n+t;u+=String.fromCharCode(n)}else{if("string"!=typeof i[e])break;u+=i[e]}else u+=e}s("Bad string")},h=function(){for(;e&&" ">=e;)o()},c=function(){switch(e){case"t":return o("t"),o("r"),o("u"),o("e"),!0;case"f":return o("f"),o("a"),o("l"),o("s"),o("e"),!1;case"n":return o("n"),o("u"),o("l"),o("l"),null}s("Unexpected '"+e+"'")},f=function(){var t=[];if("["===e){if(o("["),h(),"]"===e)return o("]"),t;for(;e;){if(t.push(n()),h(),"]"===e)return o("]"),t;o(","),h()}}s("Bad array")},l=function(){var t,r={};if("{"===e){if(o("{"),h(),"}"===e)return o("}"),r;for(;e;){if(t=a(),h(),o(":"),Object.hasOwnProperty.call(r,t)&&s('Duplicate key "'+t+'"'),r[t]=n(),h(),"}"===e)return o("}"),r;o(","),h()}}s("Bad object")};return n=function(){switch(h(),e){case"{":return l();case"[":return f();case'"':return a();case"-":return u();default:return e>="0"&&"9">=e?u():c()}},function(i,o){var u;return r=i,t=0,e=" ",u=n(),h(),e&&s("Syntax error"),"function"==typeof o?function a(t,e){var r,n,i=t[e];if(i&&"object"==typeof i)for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(n=a(i,r),void 0!==n?i[r]=n:delete i[r]);return o.call(t,e,i)}({"":u},""):u}}(),stdoutFlushed=!0;process.stdout.on("error",function(t){"EPIPE"===t.code?drainStdoutAndExit(0):(warn(t),drainStdoutAndExit(1))});var drainingStdout=!1;if(require.main===module){var nodeVer=process.versions.node.split(".").map(Number);if(nodeVer>=[0,6,0]&&[0,6,8]>=nodeVer){var stdout=process.stdout;stdout.end=stdout.destroy=stdout.destroySoon=function(){}}main(process.argv)}}(require("github:jspm/nodelibs@0.0.5/process"));
//# sourceMappingURL=json.js.map